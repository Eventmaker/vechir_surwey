<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Опитування: Відеонагляд - Вечір Телеком</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Tailwind configuration - defines custom theme settings
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'bg-dark': '#12141D',       // Dark background from the site
                        'text-light': '#ffffff',
                        'text-secondary': '#cccccc',
                        'accent-blue': '#00aaff',  // Approximate blue accent
                        'accent-pink': '#ff00ff',  // Approximate pink/purple accent
                        'border-color': '#333',
                        'input-bg': '#2a2d35',
                        'input-bg-hover': '#3a3f4a',
                        'btn-disabled-bg': '#555',
                        'btn-disabled-text': '#999',
                        'error-bg': '#4d1f2a',     // Background for error messages
                        'error-border': '#ff4d6d', // Border for error messages
                        'error-text': '#ffcad4',   // Text color for error messages
                        // Added for glossy effect
                        'gloss-start': 'rgba(55, 65, 81, 0.95)', // gray-800 with opacity
                        'gloss-mid': 'rgba(0, 0, 0, 0.92)',     // black with opacity
                        'gloss-end': 'rgba(31, 41, 55, 0.95)',   // gray-900 with opacity
                        'gloss-border': 'rgba(75, 85, 99, 0.5)', // gray-700 with opacity
                    },
                    fontFamily: {
                        // Use 'Inter' as the primary font, fallback to system sans-serif
                        sans: ['Inter', 'Segoe UI', 'Tahoma', 'Geneva', 'Verdana', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom styles for elements not easily handled by Tailwind alone */
        body {
            /* --- Background Image Styling --- */
            background-image: linear-gradient(rgba(18, 20, 29, 0.85), rgba(18, 20, 29, 0.85)), url('https://vstore.net.ua/image/catalog/back.webp'); /* Dimming overlay + image */
            background-size: cover;     /* Stretch to cover */
            background-position: center; /* Center the image */
            background-attachment: fixed; /* Fix background during scroll */
            background-color: theme('colors.bg-dark'); /* Fallback color */
            /* --- End Background Image Styling --- */

            color: theme('colors.text-light');
            font-family: theme('fontFamily.sans');
            min-height: 100vh; /* Ensure body takes full height */
            display: flex;
            flex-direction: column;
        }

        main {
            flex-grow: 1; /* Allow main content to grow and push footer down */
        }

        /* Progress bar gradient */
        .progress-bar {
            background: linear-gradient(90deg, theme('colors.accent-blue'), theme('colors.accent-pink'));
            transition: width 0.3s ease-in-out;
        }

        /* Custom radio/checkbox styling */
        input[type="radio"],
        input[type="checkbox"] {
            accent-color: theme('colors.accent-pink');
            transform: scale(1.2);
            cursor: pointer;
            margin-right: 0.75rem; /* Added margin for spacing */
            flex-shrink: 0; /* Prevent shrinking */
        }

        /* Input text color */
        input[type="text"]:not(:disabled),
        input[type="number"]:not(:disabled),
        input[type="tel"]:not(:disabled),
        input[type="email"]:not(:disabled),
        textarea:not(:disabled),
        .inline-input:not(:disabled),
        .form-input-conditional:not(:disabled) {
            color: theme('colors.accent-blue'); /* Blue text color for active inputs */
        }
        /* Ensure placeholder color is distinct */
        ::placeholder {
             color: theme('colors.text-secondary / 60%'); /* Lighter secondary color for placeholder */
             opacity: 1; /* Override browser defaults */
        }
        /* Ensure disabled inputs have appropriate color */
         input:disabled,
         textarea:disabled,
         .inline-input:disabled,
         .form-input-conditional:disabled {
            color: theme('colors.text-secondary'); /* Use secondary color for disabled inputs */
            opacity: 0.6; /* Slightly reduced opacity for disabled */
            cursor: not-allowed;
         }


        /* Input focus styles */
        input[type="text"]:focus,
        input[type="number"]:focus,
        input[type="tel"]:focus,    /* Added tel type */
        input[type="email"]:focus, /* Added email type */
        textarea:focus {
             outline: none;
             border-color: theme('colors.accent-blue');
             box-shadow: 0 0 5px theme('colors.accent-blue');
        }

        /* Animation for step appearance */
        .survey-step { display: none; animation: fadeIn 0.5s; }
        .survey-step.active { display: block; }
         @keyframes fadeIn {
             from { opacity: 0; transform: translateY(10px); }
             to { opacity: 1; transform: translateY(0); }
         }

        /* Ensure icons have fixed width for alignment */
        .form-group label i, .radio-label i, .checkbox-label i {
             width: 20px;
             text-align: center;
             flex-shrink: 0; /* Prevent icons from shrinking */
             margin-right: 0.75rem; /* Space between icon and text */
        }
        /* Adjust label flex alignment */
        .radio-label, .checkbox-label {
            display: flex;
            align-items: center; /* Vertically align items */
            padding: 0.75rem; /* p-3 equivalent */
            background-color: theme('colors.input-bg');
            border-radius: 0.375rem; /* rounded-md */
            cursor: pointer;
            transition: background-color 0.2s ease, border-color 0.2s ease;
            border: 1px solid transparent;
        }
        .radio-label:hover, .checkbox-label:hover {
            background-color: theme('colors.input-bg-hover');
            border-color: theme('colors.accent-blue/50');
        }

        /* Active button state */
        .btn:not(:disabled):active {
            transform: scale(0.98);
            filter: brightness(0.9);
        }

        /* Disabled button state */
        .btn:disabled {
            background-color: theme('colors.btn-disabled-bg');
            color: theme('colors.btn-disabled-text');
            cursor: not-allowed;
            opacity: 0.7;
        }

        /* Style for the error message container */
        #error-message-container {
            background-color: theme('colors.error-bg');
            border: 1px solid theme('colors.error-border');
            color: theme('colors.error-text');
            padding: 0.75rem 1rem; /* p-3 equivalent */
            border-radius: 0.375rem; /* rounded-md equivalent */
            margin-bottom: 1.25rem; /* mb-5 equivalent */
            display: none; /* Hidden by default */
            transition: opacity 0.3s ease;
        }
        #error-message-container.visible {
            display: block;
            opacity: 1;
        }

        /* Style for inline inputs used within labels */
        .inline-input {
             padding: 0.375rem 0.625rem; /* p-1.5 equivalent */
             background-color: theme('colors.bg-dark'); /* Slightly darker bg for contrast */
             border: 1px solid theme('colors.border-color');
             /* color is set globally now */
             border-radius: 0.25rem; /* rounded-sm */
             transition: border-color 0.2s ease, box-shadow 0.2s ease;
             flex-grow: 1; /* Allow it to take available space */
         }
         /* :disabled style handled globally */
         .inline-input:focus {
             border-color: theme('colors.accent-blue');
             box-shadow: 0 0 3px theme('colors.accent-blue');
         }

         /* Styling for communication preference notes */
         .comm-pref-note {
             font-size: 0.8rem;
             color: theme('colors.text-secondary');
             margin-left: calc(1.2em + 0.75rem + 0.75rem); /* checkbox size + margin + label padding */
             margin-top: -0.25rem; /* Reduce space */
             padding-bottom: 0.5rem; /* Space before next item */
             display: block; /* Ensure it takes its own line */
         }
         .conditional-input-container {
             margin-left: calc(1.2em + 0.75rem + 0.75rem); /* Align with text */
             margin-top: 0.5rem;
             padding-bottom: 0.5rem; /* Space before next item */
         }
         .form-input-conditional { /* Style for conditional inputs */
             background-color: theme('colors.input-bg');
             border: 1px solid theme('colors.border-color');
             /* color is set globally now */
             border-radius: 0.375rem; /* rounded-md */
             padding: 0.625rem; /* p-2.5 */
             width: 100%;
             font-size: 0.875rem; /* text-sm */
             transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
         }
         /* :disabled style handled globally */
         .form-input-conditional:focus {
             outline: none;
             border-color: theme('colors.accent-blue');
             box-shadow: 0 0 0 2px rgba(0, 170, 255, 0.3); /* Ring effect */
         }

         /* Glossy Background Style */
        .glossy-bg {
             background: linear-gradient(180deg, rgba(55, 65, 81, 0.95), rgba(0, 0, 0, 0.92)); /* From gray-800/95 to black/92 */
             border: 1px solid theme('colors.gloss-border');
        }

        /* Style invalid inputs */
        .border-red-500 {
            border-color: #ef4444 !important; /* Tailwind red-500, use !important to override other styles if needed */
        }

        /* Style invalid radio/checkbox labels */
        label.border-red-500 {
            border-color: #ef4444 !important;
            background-color: rgba(239, 68, 68, 0.1); /* Slight red background */
        }

    </style>
</head>
<body class="bg-bg-dark text-text-light font-sans leading-relaxed">

    <header class="flex flex-col sm:flex-row justify-between items-center p-3 sm:p-5 border-b border-border-color mb-5 bg-bg-dark/80 backdrop-blur-sm sticky top-0 z-10 shadow-md">
        <div class="flex items-center gap-3 mb-2 sm:mb-0">
             <img src="https://vechir.ua/wp-content/uploads/2021/03/logo_vechir_2021-02.svg" alt="Логотип Вечір Телеком Старий" class="h-10" onerror="this.style.display='none'">
             <div class="logo">
                 <img src="https://vechir.ua/wp-content/uploads/2021/03/logo_vechir_2021-03.svg" alt="Логотип Вечір Телеком" class="h-10" onerror="this.outerHTML='<span class=\'text-xl font-bold\'>Вечір Телеком</span>'">
             </div>
        </div>
        <div class="header-contact text-text-secondary text-sm sm:text-base">
             <i class="fa-solid fa-phone mr-1"></i>
             <a href="tel:0800303660" class="hover:text-text-light transition-colors">0 800 303 660</a> (Безкоштовно)
             </div>
    </header>


    <main class="container max-w-3xl mx-auto p-4 sm:p-5 glossy-bg rounded-lg shadow-xl mb-8">
        <section id="intro">
            <h2 class="text-2xl font-bold text-accent-blue text-center mb-5 flex items-center justify-center gap-2">
                 <i class="fa-solid fa-video"></i> Опитування щодо послуги "Відеонагляд"
            </h2>
            <p class="mb-3 text-text-secondary">Шановний абоненте,</p>
            <p class="mb-5 text-text-secondary">Дякуємо за Ваш інтерес до нової послуги "Відеонагляд" від "Вечір Телеком"! Ми прагнемо створити сервіс, який буде максимально відповідати Вашим потребам. Просимо Вас приділити кілька хвилин, щоб поділитися своєю думкою та допомогти нам зробити "Відеонагляд" зручним та простим.</p>

            <div class="flex flex-col md:flex-row items-center gap-8 my-8">
                 <div class="w-full md:w-1/3 flex justify-center items-center bg-black/20 rounded-lg p-2 shadow-inner">
                      <img src="https://vstore.net.ua/image/catalog/lmou1.webp"
                           alt="[Image of Зображення камери Imou Bullet 2E]"
                           class="block h-40 md:h-44 w-auto rounded-md" /* Adjusted height, added rounded-md */
                           onerror="this.onerror=null; this.src='https://placehold.co/200x160/2a2d35/cccccc?text=Камера+Imou'; this.classList.add('border', 'border-border-color');">
                 </div>
                 <div class="w-full md:w-2/3 prize-info bg-black/30 border border-accent-pink p-4 rounded-md text-center shadow-inner mt-6 md:mt-0">
                      <p class="mb-2 text-text-secondary">
                           <i class="fa-solid fa-gift text-accent-pink mr-2"></i> В якості подяки за участь в опитуванні, ми пропонуємо Вам можливість виграти зовнішню камеру відеоспостереження -
                           <a href="https://vstore.net.ua/ua/videosposterezhennia-i-bezpeka/kamery/3mp-h265-wi-f-bullet-2e-3mp-ipc-k3dp-3h0wf28mm-181592" target="_blank" rel="noopener noreferrer" class="text-accent-blue hover:underline font-semibold">Imou Bullet 2E</a>.
                      </p>
                      <p class="text-sm text-text-secondary"><strong>Дата розіграшу:</strong> [буде відома пізніше] | <strong>Платформа:</strong> Instagram</p>
                 </div>
            </div>

            <div class="text-center mt-8">
                 <button class="btn bg-accent-blue hover:bg-blue-500 text-text-light font-bold py-2.5 px-8 rounded-md uppercase transition-colors duration-300 shadow-md hover:shadow-lg" id="start-survey-btn">Розпочати опитування</button>
            </div>
        </section>

        <section id="survey-form" class="hidden">
            <form id="video-survey" novalidate>
                 <div class="progress-indicator mb-8">
                     <div class="progress-bar-container w-full bg-input-bg rounded-full h-2.5 overflow-hidden shadow-inner">
                         <div class="progress-bar h-full rounded-full" id="progress-bar" style="width: 0%;"></div>
                     </div>
                     <div class="progress-text text-center mt-2 text-sm text-text-secondary" id="progress-text">Крок 1 з 11</div>
                 </div>

                 <div id="error-message-container" role="alert">
                     <p id="error-message-text"></p>
                 </div>

                 <div class="survey-step active" data-step="1">
                     <h3 class="text-xl font-semibold text-accent-blue mb-4 flex items-center gap-2"><i class="fa-solid fa-address-card"></i> Питання 1: Контактна інформація</h3>
                     <div class="form-group mb-5">
                         <label for="phone-number" class="block mb-2 font-medium text-text-secondary flex items-center">
                             <i class="fa-solid fa-phone"></i> Ваш контактний номер телефону<span class="text-accent-pink ml-1">*</span>
                         </label>
                         <input type="tel" id="phone-number" name="phone_number" placeholder="+380 XX XXX XX XX" required class="w-full p-2.5 bg-input-bg border border-border-color rounded-md focus:border-accent-blue focus:ring-accent-blue focus:ring-1 transition">
                         <p class="input-hint text-xs text-text-secondary mt-1">Будь ласка, вкажіть дійсний номер для зв'язку.</p>
                     </div>
                     <div class="form-group mb-5">
                         <label for="contract-number" class="block mb-2 font-medium text-text-secondary flex items-center">
                            <i class="fa-solid fa-file-contract"></i> Ваш номер договору (ППК) </label>
                         <input type="text" id="contract-number" name="contract_number" placeholder="Введіть ваш Персональний платіжний код" class="w-full p-2.5 bg-input-bg border border-border-color rounded-md focus:border-accent-blue focus:ring-accent-blue focus:ring-1 transition">
                         <p class="input-hint text-xs text-text-secondary mt-1">Вкажіть Ваш Персональний платіжний код (якщо бажаєте).</p>
                     </div>
                     <div class="navigation-buttons flex flex-col-reverse sm:flex-row justify-between mt-8 pt-5 border-t border-border-color">
                         <button type="button" class="btn btn-back bg-input-bg hover:bg-input-bg-hover text-text-secondary border border-border-color font-bold py-2 px-6 rounded-md uppercase transition-colors duration-300 w-full sm:w-auto mb-2 sm:mb-0" disabled>Назад</button>
                         <button type="button" class="btn btn-next bg-accent-blue hover:bg-blue-500 text-text-light font-bold py-2 px-6 rounded-md uppercase transition-colors duration-300 w-full sm:w-auto">Далі</button>
                     </div>
                 </div>

                 <div class="survey-step" data-step="2">
                      <h3 class="text-xl font-semibold text-accent-blue mb-4 flex items-center gap-2"><i class="fa-solid fa-house-chimney-window"></i> Питання 2: Який тип приміщення? <span class="text-accent-pink ml-1">*</span></h3>
                      <div class="form-group space-y-3 mb-5">
                           <label class="radio-label">
                               <input type="radio" name="premise_type" value="Квартира" required>
                               <i class="fa-solid fa-building text-accent-blue"></i> Квартира
                           </label>
                           <label class="radio-label">
                               <input type="radio" name="premise_type" value="Приватний будинок">
                               <i class="fa-solid fa-house text-accent-blue"></i> Приватний будинок
                           </label>
                           <label class="radio-label">
                               <input type="radio" name="premise_type" value="Офіс">
                               <i class="fa-solid fa-briefcase text-accent-blue"></i> Офіс
                           </label>
                           <label class="radio-label">
                               <input type="radio" name="premise_type" value="Магазин">
                               <i class="fa-solid fa-store text-accent-blue"></i> Магазин
                           </label>
                           <label class="radio-label flex-wrap">
                               <input type="radio" name="premise_type" value="Інше">
                               <i class="fa-solid fa-question text-accent-blue"></i> Інше
                               <input type="text" name="premise_type_other" class="inline-input mt-2 sm:mt-0 sm:ml-2" placeholder="Вкажіть тип" disabled>
                           </label>
                      </div>
                      <div class="navigation-buttons flex flex-col-reverse sm:flex-row justify-between mt-8 pt-5 border-t border-border-color">
                           <button type="button" class="btn btn-back bg-input-bg hover:bg-input-bg-hover text-text-secondary border border-border-color font-bold py-2 px-6 rounded-md uppercase transition-colors duration-300 w-full sm:w-auto mb-2 sm:mb-0">Назад</button>
                           <button type="button" class="btn btn-next bg-accent-blue hover:bg-blue-500 text-text-light font-bold py-2 px-6 rounded-md uppercase transition-colors duration-300 w-full sm:w-auto">Далі</button>
                      </div>
                 </div>

                 <div class="survey-step" data-step="3">
                      <h3 class="text-xl font-semibold text-accent-blue mb-4 flex items-center gap-2"><i class="fa-solid fa-video-camera"></i> Питання 3: Чи користуєтесь Ви зараз системою відеоспостереження? <span class="text-accent-pink ml-1">*</span></h3>
                      <div class="form-group space-y-3 mb-5">
                           <label class="radio-label">
                               <input type="radio" name="using_now" value="Так" required data-next-step="5"> <i class="fa-solid fa-check text-accent-blue"></i> Так
                           </label>
                           <label class="radio-label">
                               <input type="radio" name="using_now" value="Ні" required data-next-step="4"> <i class="fa-solid fa-times text-accent-blue"></i> Ні
                           </label>
                      </div>
                      <div class="navigation-buttons flex flex-col-reverse sm:flex-row justify-between mt-8 pt-5 border-t border-border-color">
                           <button type="button" class="btn btn-back bg-input-bg hover:bg-input-bg-hover text-text-secondary border border-border-color font-bold py-2 px-6 rounded-md uppercase transition-colors duration-300 w-full sm:w-auto mb-2 sm:mb-0">Назад</button>
                           <button type="button" class="btn btn-next bg-accent-blue hover:bg-blue-500 text-text-light font-bold py-2 px-6 rounded-md uppercase transition-colors duration-300 w-full sm:w-auto">Далі</button>
                      </div>
                 </div>

                 <div class="survey-step" data-step="4">
                      <h3 class="text-xl font-semibold text-accent-blue mb-4 flex items-center gap-2"><i class="fa-solid fa-circle-question"></i> Питання 4: Оберіть основну причину, чому не користуєтесь <span class="text-accent-pink ml-1">*</span></h3>
                      <div class="form-group space-y-3 mb-5">
                           <label class="radio-label">
                                <input type="radio" name="reason_not_using" value="Висока вартість" required>
                                <i class="fa-solid fa-dollar-sign text-accent-blue"></i> Висока вартість
                           </label>
                           <label class="radio-label">
                                <input type="radio" name="reason_not_using" value="Складність встановлення">
                                <i class="fa-solid fa-screwdriver-wrench text-accent-blue"></i> Складність встановлення та налаштування
                           </label>
                           <label class="radio-label">
                                <input type="radio" name="reason_not_using" value="Необхідність обслуговування">
                                <i class="fa-solid fa-user-gear text-accent-blue"></i> Необхідність обслуговування
                           </label>
                           <label class="radio-label">
                                <input type="radio" name="reason_not_using" value="Недостатня обізнаність">
                                <i class="fa-solid fa-info-circle text-accent-blue"></i> Недостатня обізнаність про переваги
                           </label>
                           <label class="radio-label flex-wrap">
                                <input type="radio" name="reason_not_using" value="Інше">
                                <i class="fa-solid fa-question text-accent-blue"></i> Інше
                                <input type="text" name="reason_not_using_other" class="inline-input mt-2 sm:mt-0 sm:ml-2" placeholder="Вкажіть причину" disabled>
                           </label>
                      </div>
                      <div class="navigation-buttons flex flex-col-reverse sm:flex-row justify-between mt-8 pt-5 border-t border-border-color">
                           <button type="button" class="btn btn-back bg-input-bg hover:bg-input-bg-hover text-text-secondary border border-border-color font-bold py-2 px-6 rounded-md uppercase transition-colors duration-300 w-full sm:w-auto mb-2 sm:mb-0">Назад</button>
                           <button type="button" class="btn btn-next bg-accent-blue hover:bg-blue-500 text-text-light font-bold py-2 px-6 rounded-md uppercase transition-colors duration-300 w-full sm:w-auto">Далі</button>
                      </div>
                 </div>

                 <div class="survey-step" data-step="5">
                      <h3 class="text-xl font-semibold text-accent-blue mb-2 flex items-center gap-2"><i class="fa-solid fa-bullseye"></i> Питання 5: Які Ваші основні цілі від відеоспостереження?</h3>
                      <p class="input-hint text-sm text-text-secondary mb-4">Оберіть 1-2 найважливіші пункти. <span class="text-accent-pink ml-1">*</span></p>
                      <div class="form-group space-y-3 mb-5">
                           <label class="checkbox-label">
                               <input type="checkbox" name="goals[]" value="Безпека">
                               <i class="fa-solid fa-shield-halved text-accent-blue"></i> Забезпечення безпеки та захист від крадіжок
                           </label>
                           <label class="checkbox-label">
                               <input type="checkbox" name="goals[]" value="Контроль">
                               <i class="fa-solid fa-users-viewfinder text-accent-blue"></i> Контроль за дітьми/персоналом/територією
                           </label>
                           <label class="checkbox-label">
                               <input type="checkbox" name="goals[]" value="Докази">
                               <i class="fa-solid fa-file-video text-accent-blue"></i> Отримання доказів у разі інцидентів
                           </label>
                           <label class="checkbox-label">
                               <input type="checkbox" name="goals[]" value="Спокій">
                               <i class="fa-solid fa-face-smile-beam text-accent-blue"></i> Спокій та впевненість
                           </label>
                           <label class="checkbox-label flex-wrap">
                               <input type="checkbox" name="goals[]" value="Інше">
                               <i class="fa-solid fa-question text-accent-blue"></i> Інше
                               <input type="text" name="goals_other" class="inline-input mt-2 sm:mt-0 sm:ml-2" placeholder="Вкажіть ціль" disabled>
                           </label>
                      </div>
                       <div class="navigation-buttons flex flex-col-reverse sm:flex-row justify-between mt-8 pt-5 border-t border-border-color">
                           <button type="button" class="btn btn-back bg-input-bg hover:bg-input-bg-hover text-text-secondary border border-border-color font-bold py-2 px-6 rounded-md uppercase transition-colors duration-300 w-full sm:w-auto mb-2 sm:mb-0">Назад</button>
                           <button type="button" class="btn btn-next bg-accent-blue hover:bg-blue-500 text-text-light font-bold py-2 px-6 rounded-md uppercase transition-colors duration-300 w-full sm:w-auto">Далі</button>
                      </div>
                 </div>

                 <div class="survey-step" data-step="6">
                      <h3 class="text-xl font-semibold text-accent-blue mb-4 flex items-center gap-2"><i class="fa-solid fa-hand-holding-dollar"></i> Питання 6: Бажана модель оплати та бюджет <span class="text-accent-pink ml-1">*</span></h3>
                      <p class="input-hint text-sm text-text-secondary mb-4">Який варіант оплати послуги відеоспостереження для Вас найзручніший?</p>
                      <div class="form-group space-y-3 mb-5">
                           <label class="radio-label">
                               <input type="radio" name="payment_model_budget" value="rent_under_300" required>
                               <i class="fa-solid fa-calendar-days text-accent-blue"></i> Щомісячна оренда (до 300 грн/міс)
                           </label>
                           <label class="radio-label">
                               <input type="radio" name="payment_model_budget" value="rent_300_500">
                               <i class="fa-solid fa-calendar-days text-accent-blue"></i> Щомісячна оренда (300-500 грн/міс)
                           </label>
                           <label class="radio-label">
                               <input type="radio" name="payment_model_budget" value="rent_500_800">
                               <i class="fa-solid fa-calendar-days text-accent-blue"></i> Щомісячна оренда (500-800 грн/міс)
                           </label>
                           <label class="radio-label">
                               <input type="radio" name="payment_model_budget" value="rent_over_800">
                               <i class="fa-solid fa-calendar-days text-accent-blue"></i> Щомісячна оренда (більше 800 грн/міс)
                           </label>
                           <label class="radio-label">
                               <input type="radio" name="payment_model_budget" value="purchase">
                               <i class="fa-solid fa-credit-card text-accent-blue"></i> Одноразова купівля обладнання
                           </label>
                           <label class="radio-label">
                               <input type="radio" name="payment_model_budget" value="undecided">
                               <i class="fa-solid fa-circle-question text-accent-blue"></i> Не визначився / Залежить від умов
                           </label>
                      </div>
                      <div class="navigation-buttons flex flex-col-reverse sm:flex-row justify-between mt-8 pt-5 border-t border-border-color">
                           <button type="button" class="btn btn-back bg-input-bg hover:bg-input-bg-hover text-text-secondary border border-border-color font-bold py-2 px-6 rounded-md uppercase transition-colors duration-300 w-full sm:w-auto mb-2 sm:mb-0">Назад</button>
                           <button type="button" class="btn btn-next bg-accent-blue hover:bg-blue-500 text-text-light font-bold py-2 px-6 rounded-md uppercase transition-colors duration-300 w-full sm:w-auto">Далі</button>
                      </div>
                 </div>

                 <div class="survey-step" data-step="7">
                     <h3 class="text-xl font-semibold text-accent-blue mb-4 flex items-center gap-2"><i class="fa-solid fa-camera-retro"></i> Питання 7: Необхідна кількість камер <span class="text-accent-pink ml-1">*</span></h3>
                     <div class="form-group space-y-3 mb-5">
                          <label class="radio-label">
                              <input type="radio" name="camera_count" value="1" required> 1
                          </label>
                          <label class="radio-label">
                              <input type="radio" name="camera_count" value="2-3"> 2-3
                          </label>
                          <label class="radio-label">
                              <input type="radio" name="camera_count" value="4-5"> 4-5
                          </label>
                          <label class="radio-label">
                              <input type="radio" name="camera_count" value=">5"> Більше 5
                          </label>
                     </div>
                     <div class="navigation-buttons flex flex-col-reverse sm:flex-row justify-between mt-8 pt-5 border-t border-border-color">
                          <button type="button" class="btn btn-back bg-input-bg hover:bg-input-bg-hover text-text-secondary border border-border-color font-bold py-2 px-6 rounded-md uppercase transition-colors duration-300 w-full sm:w-auto mb-2 sm:mb-0">Назад</button>
                          <button type="button" class="btn btn-next bg-accent-blue hover:bg-blue-500 text-text-light font-bold py-2 px-6 rounded-md uppercase transition-colors duration-300 w-full sm:w-auto">Далі</button>
                     </div>
                 </div>

                 <div class="survey-step" data-step="8">
                     <h3 class="text-xl font-semibold text-accent-blue mb-4 flex items-center gap-2"><i class="fa-solid fa-list-check"></i> Питання 8: Важливі функції <span class="text-accent-pink ml-1">*</span></h3>
                     <div class="form-group space-y-3 mb-5">
                          <label class="checkbox-label">
                              <input type="checkbox" name="features[]" value="Нічна зйомка">
                              <i class="fa-solid fa-moon text-accent-blue"></i> Нічна зйомка
                          </label>
                          <label class="checkbox-label">
                              <input type="checkbox" name="features[]" value="Віддалений доступ">
                              <i class="fa-solid fa-mobile-screen-button text-accent-blue"></i> Віддалений доступ (телефон/комп'ютер)
                          </label>
                          <label class="checkbox-label">
                              <input type="checkbox" name="features[]" value="Висока якість запису">
                              <i class="fa-solid fa-film text-accent-blue"></i> Висока якість запису (HD/FullHD+)
                          </label>
                          <label class="checkbox-label">
                              <input type="checkbox" name="features[]" value="Датчики руху">
                              <i class="fa-solid fa-person-running text-accent-blue"></i> Датчики руху
                          </label>
                          <label class="checkbox-label flex-wrap">
                              <input type="checkbox" name="features[]" value="Зберігання записів">
                              <i class="fa-solid fa-cloud-arrow-up text-accent-blue"></i> Зберігання записів
                              <span class="ml-1 mr-1 mt-2 sm:mt-0 text-sm text-text-secondary">(бажаний період:</span>
                              <input type="number" name="storage_days" min="1" placeholder="днів" class="inline-input p-1 w-16 text-center mt-2 sm:mt-0" disabled>
                              <span class="ml-1 mt-2 sm:mt-0 text-sm text-text-secondary"> днів)</span>
                          </label>
                          <label class="checkbox-label flex-wrap">
                              <input type="checkbox" name="features[]" value="Отримання сповіщень">
                              <i class="fa-solid fa-bell text-accent-blue"></i> Отримання сповіщень
                               <span class="ml-1 mr-1 mt-2 sm:mt-0 text-sm text-text-secondary">(зручний спосіб:</span>
                               <input type="text" name="notification_method" placeholder="напр., Telegram, SMS" class="inline-input p-1 mt-2 sm:mt-0 sm:ml-1" disabled>
                               <span class="ml-1 mt-2 sm:mt-0 text-sm text-text-secondary">)</span>
                          </label>
                     </div>
                      <div class="navigation-buttons flex flex-col-reverse sm:flex-row justify-between mt-8 pt-5 border-t border-border-color">
                          <button type="button" class="btn btn-back bg-input-bg hover:bg-input-bg-hover text-text-secondary border border-border-color font-bold py-2 px-6 rounded-md uppercase transition-colors duration-300 w-full sm:w-auto mb-2 sm:mb-0">Назад</button>
                          <button type="button" class="btn btn-next bg-accent-blue hover:bg-blue-500 text-text-light font-bold py-2 px-6 rounded-md uppercase transition-colors duration-300 w-full sm:w-auto">Далі</button>
                      </div>
                 </div>

                 <div class="survey-step" data-step="9">
                     <h3 class="text-xl font-semibold text-accent-blue mb-4 flex items-center gap-2"><i class="fa-solid fa-puzzle-piece"></i> Питання 9: Додаткові послуги та підтримка</h3>
                     <div class="form-group space-y-4 mb-5">
                         <div>
                             <label class="checkbox-label">
                                 <input type="checkbox" name="needs_consultation" value="yes">
                                 <i class="fa-solid fa-headset text-accent-blue"></i> Бажаю отримати консультацію щодо підбору та налаштування
                             </label>
                         </div>
                         <div>
                             <label class="checkbox-label">
                                 <input type="checkbox" id="interested-other-services-cb" name="interested_other_services" value="yes">
                                 <i class="fa-solid fa-shield-dog text-accent-blue"></i> Цікавлять інші послуги безпеки (напр., датчики, сигналізація)
                             </label>
                             <div id="other-services-details-container" class="conditional-input-container hidden">
                                  <label for="other_services_details" class="block mb-1 text-sm font-medium text-text-secondary">Будь ласка, вкажіть, які саме послуги Вас цікавлять:</label>
                                  <input type="text" id="other_services_details" name="other_services_details" placeholder="Наприклад: датчики руху, диму..." class="form-input-conditional">
                             </div>
                         </div>
                     </div>
                     <div class="navigation-buttons flex flex-col-reverse sm:flex-row justify-between mt-8 pt-5 border-t border-border-color">
                         <button type="button" class="btn btn-back bg-input-bg hover:bg-input-bg-hover text-text-secondary border border-border-color font-bold py-2 px-6 rounded-md uppercase transition-colors duration-300 w-full sm:w-auto mb-2 sm:mb-0">Назад</button>
                         <button type="button" class="btn btn-next bg-accent-blue hover:bg-blue-500 text-text-light font-bold py-2 px-6 rounded-md uppercase transition-colors duration-300 w-full sm:w-auto">Далі</button>
                     </div>
                 </div>

                 <div class="survey-step" data-step="10">
                     <h3 class="text-xl font-semibold text-accent-blue mb-2 flex items-center gap-2"><i class="fa-solid fa-envelope-open-text"></i> Питання 10: Бажані способи зв'язку</h3>
                     <p class="input-hint text-sm text-text-secondary mb-4">Оберіть зручні канали для отримання важливих повідомлень від нас (стан послуг, акції, новини):</p>
                     <div class="form-group space-y-1 mb-5">
                          <div>
                              <label class="checkbox-label">
                                   <input type="checkbox" id="comm-viber" name="communication_prefs[]" value="viber">
                                   <i class="fab fa-viber text-purple-500"></i> Viber
                              </label>
                              <span class="comm-pref-note">Ми будемо використовувати номер телефону, вказаний Вами раніше.</span>
                          </div>
                          <div>
                              <label class="checkbox-label">
                                   <input type="checkbox" id="comm-telegram" name="communication_prefs[]" value="telegram">
                                   <i class="fab fa-telegram text-sky-500"></i> Telegram Бот
                              </label>
                               <span class="comm-pref-note">Ми надішлемо запрошення до нашого інформаційного боту.</span>
                               <div id="telegram-username-container" class="conditional-input-container hidden">
                                   <label for="telegram-username" class="block mb-1 text-sm font-medium text-text-secondary">Ваш Telegram username (необов'язково):</label>
                                   <input type="text" id="telegram-username" name="telegram_username" class="form-input-conditional" placeholder="@username">
                               </div>
                          </div>
                          <div>
                              <label class="checkbox-label">
                                   <input type="checkbox" id="comm-email" name="communication_prefs[]" value="email">
                                   <i class="fa-solid fa-at text-red-500"></i> Email
                              </label>
                              <div id="email-input-container" class="conditional-input-container hidden">
                                   <label for="email-address" class="block mb-1 text-sm font-medium text-text-secondary">Ваша Email адреса:<span class="text-accent-pink ml-1">*</span></label>
                                   <input type="email" id="email-address" name="email_address" class="form-input-conditional" placeholder="example@email.com">
                              </div>
                          </div>
                          <div>
                              <label class="checkbox-label">
                                   <input type="checkbox" id="comm-sms" name="communication_prefs[]" value="sms">
                                   <i class="fa-solid fa-comment-sms text-green-500"></i> SMS
                              </label>
                              <span class="comm-pref-note">На номер телефону, вказаний раніше.</span>
                          </div>
                           <div class="pt-3">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="comm-none" name="communication_prefs_optout" value="none">
                                    <i class="fa-solid fa-comment-slash text-gray-500"></i> Не бажаю отримувати додаткові інформаційні повідомлення
                                </label>
                           </div>
                     </div>
                     <div class="navigation-buttons flex flex-col-reverse sm:flex-row justify-between mt-8 pt-5 border-t border-border-color">
                          <button type="button" class="btn btn-back bg-input-bg hover:bg-input-bg-hover text-text-secondary border border-border-color font-bold py-2 px-6 rounded-md uppercase transition-colors duration-300 w-full sm:w-auto mb-2 sm:mb-0">Назад</button>
                          <button type="button" class="btn btn-next bg-accent-blue hover:bg-blue-500 text-text-light font-bold py-2 px-6 rounded-md uppercase transition-colors duration-300 w-full sm:w-auto">Далі</button>
                     </div>
                 </div>

                 <div class="survey-step" data-step="11">
                      <h3 class="text-xl font-semibold text-accent-blue mb-4 flex items-center gap-2"><i class="fa-solid fa-pen-to-square"></i> Питання 11: Ваші побажання та коментарі</h3>
                      <div class="form-group mb-5">
                           <label for="comments" class="block mb-2 font-medium text-text-secondary">Розкажіть, що ще важливо для Вас у послузі відеоспостереження?</label>
                           <textarea id="comments" name="comments" rows="4" placeholder="Напишіть Ваші думки тут..." class="w-full p-2.5 bg-input-bg border border-border-color rounded-md focus:border-accent-blue focus:ring-accent-blue focus:ring-1 transition resize-vertical"></textarea>
                      </div>
                      <div class="navigation-buttons flex flex-col-reverse sm:flex-row justify-between mt-8 pt-5 border-t border-border-color">
                           <button type="button" class="btn btn-back bg-input-bg hover:bg-input-bg-hover text-text-secondary border border-border-color font-bold py-2 px-6 rounded-md uppercase transition-colors duration-300 w-full sm:w-auto mb-2 sm:mb-0">Назад</button>
                           <button type="button" class="btn btn-submit bg-accent-pink hover:bg-pink-700 text-text-light font-bold py-2 px-6 rounded-md uppercase transition-colors duration-300 w-full sm:w-auto">Відправити</button>
                      </div>
                 </div>

            </form>
        </section>

        <section id="success-message" class="hidden text-center p-10">
             <i class="fa-solid fa-circle-check text-6xl text-accent-pink mb-6 block animate-pulse"></i>
             <h2 class="text-3xl font-bold text-accent-blue mb-4">Дякуємо за Ваші відповіді!</h2>
             <p class="mb-3 text-lg text-text-secondary">Ваша думка дуже важлива для нас і допоможе зробити послугу "Відеонагляд" ще кращою.</p>
             <p class="text-lg text-text-secondary">Бажаємо успіху в розіграші камери Imou Bullet 2E!</p>
             <div class="mt-8">
                 <a href="https://eventmaker.github.io/vechir_video/"
                    target="_blank" rel="noopener noreferrer"
                    class="btn bg-accent-blue hover:bg-blue-500 text-text-light font-bold py-2 px-6 rounded-md uppercase transition-colors duration-300 shadow-md hover:shadow-lg">
                     Переглянути тарифи
                 </a>
             </div>
        </section>

    </main>

    <footer class="text-center mt-auto py-4 text-sm text-text-secondary border-t border-border-color bg-bg-dark/80">
        © Вечір Телеком, 2025. Всі права захищено.
    </footer>

<script>
    // JavaScript remains largely the same as the previous version.
    // The validation logic already adapts to the removed 'required' attribute.
    // No new conditional logic was added that requires JS changes beyond what was already there.
    // The step counting and navigation logic automatically adapts to the number of '.survey-step' elements.
    document.addEventListener('DOMContentLoaded', function() {
        // --- DOM Element References ---
        const introSection = document.getElementById('intro');
        const surveyFormSection = document.getElementById('survey-form');
        const successMessageSection = document.getElementById('success-message');
        const startBtn = document.getElementById('start-survey-btn');
        const form = document.getElementById('video-survey');
        const steps = form.querySelectorAll('.survey-step');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const errorContainer = document.getElementById('error-message-container');
        const errorTextElement = document.getElementById('error-message-text');
        const totalSteps = steps.length; // Automatically counts steps (now 11)
        let currentStep = 1;
        const history = [1]; // Track visited steps for back navigation

        // --- References for Communication Preferences (Step 10 - was 12) ---
        const commViberCheckbox = document.getElementById('comm-viber');
        const commTelegramCheckbox = document.getElementById('comm-telegram');
        const commEmailCheckbox = document.getElementById('comm-email');
        const commSmsCheckbox = document.getElementById('comm-sms');
        const commNoneCheckbox = document.getElementById('comm-none');
        const telegramContainer = document.getElementById('telegram-username-container');
        const emailContainer = document.getElementById('email-input-container');
        const emailInput = document.getElementById('email-address');
        const telegramInput = document.getElementById('telegram-username');
        const communicationCheckboxes = [commViberCheckbox, commTelegramCheckbox, commEmailCheckbox, commSmsCheckbox];

        // --- References for Additional Services (Step 9 - new) ---
        const interestedOtherServicesCheckbox = document.getElementById('interested-other-services-cb');
        const otherServicesDetailsContainer = document.getElementById('other-services-details-container');
        const otherServicesDetailsInput = document.getElementById('other_services_details');

        // --- Helper Functions ---

        /**
         * Updates the progress bar and text indicator.
         */
        function updateProgress() {
            const progressPercentage = totalSteps > 1 ? ((currentStep -1) / (totalSteps -1)) * 100 : (currentStep >= totalSteps ? 100 : 0);
            progressBar.style.width = `${progressPercentage}%`;
            progressText.textContent = `Крок ${currentStep} з ${totalSteps}`;
        }


        /**
         * Displays a specific survey step by its number.
         * @param {number} stepNumber - The step number to display (1-indexed).
         */
        function showStep(stepNumber) {
            steps.forEach(step => step.classList.remove('active'));
            const stepToShow = form.querySelector(`.survey-step[data-step="${stepNumber}"]`);
            if (stepToShow) {
                stepToShow.classList.add('active');
                currentStep = stepNumber;
                const backBtn = stepToShow.querySelector('.btn-back');
                if (backBtn) {
                    backBtn.disabled = history.length <= 1;
                }
                updateProgress();
                hideError();
                surveyFormSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            } else {
                console.error("Step not found:", stepNumber);
            }
        }

        /**
         * Displays an error message.
         * @param {string} message - The error message.
         */
        function showError(message) {
            errorTextElement.textContent = message;
            errorContainer.classList.add('visible');
            errorContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        /**
         * Hides the error message container.
         */
        function hideError() {
            errorContainer.classList.remove('visible');
            errorTextElement.textContent = '';
        }

        /**
         * Basic email format validation.
         * @param {string} email - The email string.
         * @returns {boolean} - True if valid format.
         */
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }


        /**
         * Validates the inputs within the currently active step.
         * @param {HTMLElement} currentStepElement - The current step element.
         * @returns {boolean} - True if valid.
         */
        function validateStep(currentStepElement) {
            let isValid = true;
            let firstInvalidElement = null;
            const currentStepNumber = parseInt(currentStepElement.dataset.step);

            currentStepElement.querySelectorAll('.border-red-500').forEach(el => {
                el.classList.remove('border-red-500');
                if (el.tagName === 'LABEL' && (el.classList.contains('radio-label') || el.classList.contains('checkbox-label'))) {
                    el.style.backgroundColor = '';
                }
            });
            hideError();

            // --- Check required inputs ---
            const requiredInputs = currentStepElement.querySelectorAll('[required]');
            requiredInputs.forEach(input => {
                if (!input.closest('.survey-step.active') || input.offsetParent === null || input.disabled) {
                    return; // Skip hidden/disabled
                }

                let inputValid = true;
                const inputWrapper = (input.type === 'radio' || input.type === 'checkbox') ? input.closest('label') : input;

                if (input.type === 'radio') {
                    const groupName = input.name;
                    if (!currentStepElement.querySelector(`input[name="${groupName}"]:checked`)) {
                        inputValid = false;
                        const firstRadioLabel = currentStepElement.querySelector(`input[name="${groupName}"]`)?.closest('label');
                        if (firstRadioLabel && !firstRadioLabel.classList.contains('border-red-500')) {
                            firstRadioLabel.classList.add('border-red-500');
                            if (!firstInvalidElement) firstInvalidElement = currentStepElement.querySelector(`input[name="${groupName}"]`);
                        }
                    }
                } else if ((input.type === 'text' || input.type === 'number' || input.type === 'textarea' || input.type === 'email' || input.type === 'tel') && !input.value.trim()) {
                    inputValid = false; // Check non-radio/checkbox required fields
                } else if (input.type === 'email' && input.value.trim() && !isValidEmail(input.value.trim())) {
                    inputValid = false;
                    showError('Будь ласка, введіть дійсну адресу електронної пошти.');
                }

                if (!inputValid && inputWrapper) {
                     inputWrapper.classList.add('border-red-500');
                     if (!firstInvalidElement) firstInvalidElement = input;
                }
                if (!inputValid) isValid = false;
            });

            // --- Specific Step Validations ---
            if (currentStepNumber === 5) { // Goals
                const goalsCheckedCount = currentStepElement.querySelectorAll('input[name="goals[]"]:checked').length;
                if (goalsCheckedCount === 0) {
                     isValid = false;
                     const firstGoalLabel = currentStepElement.querySelector('input[name="goals[]"]').closest('label');
                     if (firstGoalLabel) {
                         firstGoalLabel.classList.add('border-red-500');
                          if (!firstInvalidElement) firstInvalidElement = currentStepElement.querySelector('input[name="goals[]"]');
                     }
                     showError('Будь ласка, оберіть хоча б одну ціль.');
                } else if (goalsCheckedCount > 2) {
                    isValid = false;
                    showError('Будь ласка, оберіть не більше двох цілей.');
                    currentStepElement.querySelectorAll('input[name="goals[]"]:checked').forEach(cb => {
                         const label = cb.closest('label');
                         if(label) label.classList.add('border-red-500');
                         if (!firstInvalidElement) firstInvalidElement = cb;
                    });
                }
            } else if (currentStepNumber === 8) { // Features
                  const featuresCheckedCount = currentStepElement.querySelectorAll('input[name="features[]"]:checked').length;
                  if (featuresCheckedCount === 0) {
                      isValid = false;
                      const firstFeatureLabel = currentStepElement.querySelector('input[name="features[]"]').closest('label');
                       if (firstFeatureLabel) {
                          firstFeatureLabel.classList.add('border-red-500');
                           if (!firstInvalidElement) firstInvalidElement = currentStepElement.querySelector('input[name="features[]"]');
                      }
                      showError('Будь ласка, оберіть хоча б одну важливу функцію.');
                  }
             } else if (currentStepNumber === 10) { // Communication Prefs
                 if (commEmailCheckbox && commEmailCheckbox.checked && emailInput && !emailInput.value.trim()) {
                     isValid = false;
                     emailInput.classList.add('border-red-500');
                     if (!firstInvalidElement) firstInvalidElement = emailInput;
                     showError('Будь ласка, вкажіть Вашу Email адресу, оскільки Ви обрали цей канал.');
                 } else if (commEmailCheckbox && commEmailCheckbox.checked && emailInput && emailInput.value.trim() && !isValidEmail(emailInput.value.trim())) {
                     isValid = false;
                     emailInput.classList.add('border-red-500');
                     if (!firstInvalidElement) firstInvalidElement = emailInput;
                     // Error message already set
                 }
             }

            // --- Validation for Dependent "Other" Text Inputs ---
            const otherInputsLogic = [
                { checkboxSelector: 'input[name="premise_type"][value="Інше"]:checked', textInputName: 'premise_type_other' },
                { checkboxSelector: 'input[name="reason_not_using"][value="Інше"]:checked', textInputName: 'reason_not_using_other' },
                { checkboxSelector: 'input[name="goals[]"][value="Інше"]:checked', textInputName: 'goals_other' },
                { checkboxSelector: 'input[name="features[]"][value="Зберігання записів"]:checked', textInputName: 'storage_days' },
                { checkboxSelector: 'input[name="features[]"][value="Отримання сповіщень"]:checked', textInputName: 'notification_method' },
                { checkboxSelector: 'input[name="interested_other_services"][value="yes"]:checked', textInputName: 'other_services_details' }
            ];

            otherInputsLogic.forEach(logic => {
                 const checkbox = currentStepElement.querySelector(logic.checkboxSelector);
                 if (checkbox) {
                     const textInput = currentStepElement.querySelector(`[name="${logic.textInputName}"]`);
                     // Check if the corresponding text input is required (which it is if the checkbox is checked) and empty
                     if (textInput && textInput.required && !textInput.value.trim()) {
                         isValid = false;
                         textInput.classList.add('border-red-500');
                         if (!firstInvalidElement) firstInvalidElement = textInput;
                     }
                 }
            });


            if (!isValid && !errorContainer.classList.contains('visible')) {
                showError('Будь ласка, заповніть або виберіть значення для всіх обов\'язкових полів, позначених *. ');
            }

            if (firstInvalidElement) {
                firstInvalidElement.focus();
            }

            return isValid;
        }


        // --- Event Handlers ---
        startBtn.addEventListener('click', () => {
            introSection.style.display = 'none';
            surveyFormSection.style.display = 'block';
            showStep(1);
        });

        form.addEventListener('click', function(event) {
            const target = event.target;

            if (target.classList.contains('btn-next')) {
                const currentStepElement = target.closest('.survey-step');
                const currentStepNumber = parseInt(currentStepElement.dataset.step);
                if (!validateStep(currentStepElement)) return;

                let nextStepNumber = currentStepNumber + 1;
                if (currentStepNumber === 3) {
                    const usingNowChecked = form.querySelector('input[name="using_now"]:checked');
                    if (usingNowChecked) nextStepNumber = parseInt(usingNowChecked.dataset.nextStep);
                    else return;
                } else if (currentStepNumber === 4) {
                    nextStepNumber = 5;
                }

                if (nextStepNumber <= totalSteps) {
                    if (history[history.length - 1] !== nextStepNumber) history.push(nextStepNumber);
                    showStep(nextStepNumber);
                }
            } else if (target.classList.contains('btn-back')) {
                if (history.length > 1) {
                    history.pop();
                    showStep(history[history.length - 1]);
                }
            } else if (target.classList.contains('btn-submit')) {
                 const currentStepElement = target.closest('.survey-step');
                 if (!validateStep(currentStepElement)) return;
                console.log('Form submitted!');
                const formData = new FormData(form);
                const data = {};
                data['goals'] = formData.getAll('goals[]');
                data['features'] = formData.getAll('features[]');
                data['communication_prefs'] = formData.getAll('communication_prefs[]');

                for (let [key, value] of formData.entries()) {
                    if (key.endsWith('[]')) continue;
                    if (key.endsWith('_other') && value.trim() === '') continue;
                    if (key === 'telegram_username' && value.trim() === '') continue;
                    if (key === 'email_address' && value.trim() === '' && !(commEmailCheckbox && commEmailCheckbox.checked)) continue;
                    if (key === 'storage_days' && value.trim() === '') continue;
                    if (key === 'notification_method' && value.trim() === '') continue;
                    if (key === 'other_services_details' && value.trim() === '' && !(interestedOtherServicesCheckbox && interestedOtherServicesCheckbox.checked)) continue;
                    if (key === 'comments' && value.trim() === '') continue;
                    // Contract number is no longer required, but include if filled
                    // if (key === 'contract_number' && value.trim() === '') continue; // Keep it simple, just include if present

                    if (key === 'needs_consultation' && value === 'yes') data[key] = true;
                    else if (key === 'interested_other_services' && value === 'yes') {
                         data[key] = true;
                         const details = formData.get('other_services_details');
                         data['other_services_details'] = details ? details.trim() : '';
                    } else if (key === 'communication_prefs_optout' && value === 'none') data[key] = true;
                    else if (!['needs_consultation', 'interested_other_services', 'communication_prefs_optout', 'other_services_details'].includes(key)) data[key] = value;
                }
                 if(data['communication_prefs'] && data['communication_prefs'].length === 0) delete data['communication_prefs'];

                console.log("Collected Form Data:", JSON.stringify(data, null, 2));
                // --- Demo Submit ---
                surveyFormSection.style.display = 'none';
                successMessageSection.style.display = 'block';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        });

        // --- Dynamic Input Handling ---
        form.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(input => {
            input.addEventListener('change', function(event) {
                const label = this.closest('label');
                const isChecked = this.checked;

                // Handle generic "Other" text inputs
                const otherInput = label?.querySelector('input[type="text"], input[type="number"], textarea');
                if (otherInput) {
                    otherInput.disabled = !isChecked;
                    otherInput.required = isChecked;
                    if (!isChecked) {
                        otherInput.value = '';
                        otherInput.classList.remove('border-red-500');
                    } else if (event && event.type === 'change' && (otherInput.type === 'text' || otherInput.type === 'number' || otherInput.tagName === 'TEXTAREA')) {
                         // Focus only if interaction was direct user change
                         // Check if the input is actually visible (relevant for step changes)
                         if (otherInput.offsetParent !== null) {
                            otherInput.focus();
                         }
                    }
                }

                // Handle radio groups disabling other text inputs
                 if (this.type === 'radio') {
                     const radioGroupName = this.name;
                     form.querySelectorAll(`input[type="radio"][name="${radioGroupName}"]`).forEach(radioInGroup => {
                         if (radioInGroup !== this) {
                             const relatedLabel = radioInGroup.closest('label');
                             const relatedOtherInput = relatedLabel?.querySelector('input[type="text"], input[type="number"], textarea');
                             if (relatedOtherInput) {
                                 relatedOtherInput.disabled = true;
                                 relatedOtherInput.required = false;
                                 relatedOtherInput.classList.remove('border-red-500');
                             }
                         }
                     });
                 }

                 // Specific logic for Step 9 checkbox
                 if (this.id === 'interested-other-services-cb') {
                     if (otherServicesDetailsContainer && otherServicesDetailsInput) {
                         otherServicesDetailsContainer.classList.toggle('hidden', !isChecked);
                         otherServicesDetailsInput.required = isChecked;
                         if (!isChecked) {
                             otherServicesDetailsInput.value = '';
                             otherServicesDetailsInput.classList.remove('border-red-500');
                         } else if (event && event.type === 'change') {
                              // Focus only if interaction was direct user change
                              // Check if the input is actually visible
                              if (otherServicesDetailsInput.offsetParent !== null) {
                                 otherServicesDetailsInput.focus();
                              }
                         }
                     }
                 }
            });
             // Trigger initial state check without focusing
             const initialChangeEvent = new Event('change', { bubbles: false });
             input.dispatchEvent(initialChangeEvent);
        });

        // --- Specific Question Logic ---
        // Limit Goals checkboxes
        const goalsCheckboxes = form.querySelectorAll('input[name="goals[]"]');
        goalsCheckboxes.forEach(cb => {
            cb.addEventListener('change', () => {
                const checkedCount = form.querySelectorAll('input[name="goals[]"]:checked').length;
                if (checkedCount > 2) {
                    showError("Будь ласка, оберіть не більше двох цілей.");
                    cb.checked = false;
                    cb.dispatchEvent(new Event('change', { bubbles: false }));
                } else {
                    if (errorTextElement.textContent.includes("двох цілей")) hideError();
                }
                 if(checkedCount > 0) goalsCheckboxes.forEach(gcb => gcb.closest('label')?.classList.remove('border-red-500'));
            });
        });
        // Clear Features validation
        const featuresCheckboxes = form.querySelectorAll('input[name="features[]"]');
        featuresCheckboxes.forEach(cb => {
            cb.addEventListener('change', () => {
                const checkedCount = form.querySelectorAll('input[name="features[]"]:checked').length;
                if (checkedCount > 0) {
                    featuresCheckboxes.forEach(fcb => fcb.closest('label')?.classList.remove('border-red-500'));
                    if (errorTextElement.textContent.includes("одну важливу функцію")) hideError();
                }
            });
        });

        // --- Communication Preferences Logic ---
        const toggleCommInputVisibility = (checkbox, container, inputElement) => {
             if(!checkbox || !container || !inputElement) return;
            if (checkbox.checked) {
                container.classList.remove('hidden');
                inputElement.required = (inputElement.id === 'email-address');
            } else {
                container.classList.add('hidden');
                inputElement.required = false;
                inputElement.value = '';
                inputElement.classList.remove('border-red-500');
            }
        };
        if (commEmailCheckbox) {
            commEmailCheckbox.addEventListener('change', () => {
                toggleCommInputVisibility(commEmailCheckbox, emailContainer, emailInput);
                if (commEmailCheckbox.checked && commNoneCheckbox) commNoneCheckbox.checked = false;
            });
            toggleCommInputVisibility(commEmailCheckbox, emailContainer, emailInput);
        }
        if (commTelegramCheckbox) {
            commTelegramCheckbox.addEventListener('change', () => {
                toggleCommInputVisibility(commTelegramCheckbox, telegramContainer, telegramInput);
                 if (commTelegramCheckbox.checked && commNoneCheckbox) commNoneCheckbox.checked = false;
            });
            toggleCommInputVisibility(commTelegramCheckbox, telegramContainer, telegramInput);
        }
        [commViberCheckbox, commSmsCheckbox].forEach(cb => {
            if (cb) {
                cb.addEventListener('change', () => {
                    if (cb.checked && commNoneCheckbox) commNoneCheckbox.checked = false;
                });
            }
        });
        if (commNoneCheckbox) {
            commNoneCheckbox.addEventListener('change', () => {
                if (commNoneCheckbox.checked) {
                    communicationCheckboxes.forEach(cb => {
                        if (cb && cb.checked) {
                            cb.checked = false;
                            cb.dispatchEvent(new Event('change', { bubbles: false }));
                        }
                    });
                }
            });
        }

        // --- Input Validation Highlighting Removal ---
        form.querySelectorAll('input, textarea').forEach(input => {
            input.addEventListener('input', () => { // Use 'input' for immediate feedback
                const wrapper = (input.type === 'radio' || input.type === 'checkbox') ? input.closest('label') : input;
                if (wrapper && wrapper.classList.contains('border-red-500')) {
                    let shouldRemoveError = false;
                    if (input.type === 'radio') {
                        if (form.querySelector(`input[name="${input.name}"]:checked`)) {
                            shouldRemoveError = true;
                            form.querySelectorAll(`input[name="${input.name}"]`).forEach(radio => radio.closest('label')?.classList.remove('border-red-500'));
                        }
                    } else if (input.type === 'checkbox') {
                        const groupName = input.name;
                         const isGroup = groupName.endsWith('[]');
                         const isChecked = isGroup ? form.querySelector(`input[name="${groupName}"]:checked`) : input.checked;
                        if (isChecked) { // Remove error if *any* checkbox in a required group is checked, or if the single checkbox is checked
                            shouldRemoveError = true;
                            if(isGroup) form.querySelectorAll(`input[name="${groupName}"]`).forEach(cb => cb.closest('label')?.classList.remove('border-red-500'));
                            else wrapper.classList.remove('border-red-500');
                        }
                    } else if (input.type === 'email') {
                        // Remove red border while typing, full validation happens on step change
                        if (input.value.trim()) shouldRemoveError = true; // Basic check
                         // More robust: remove only if potentially valid during typing
                         // if (input.value.includes('@') || input.value.trim() === '') shouldRemoveError = true;
                    }
                     else if (input.value.trim()) { // For text, tel, number, textarea
                        shouldRemoveError = true;
                    }

                    if (shouldRemoveError) wrapper.classList.remove('border-red-500');
                }
            });
             // Also use 'change' for radio/checkboxes as 'input' might not cover all cases
             if(input.type === 'radio' || input.type === 'checkbox') {
                 input.addEventListener('change', () => {
                     input.dispatchEvent(new Event('input', { bubbles: false })); // Trigger the 'input' handler logic
                 });
             }
        });

        // --- Initialize ---
        updateProgress();

    });
</script>

</body>
</html>
